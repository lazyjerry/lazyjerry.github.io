---
title: Agent 變更範圍控管規範（Strict Scope Guard）
applyTo: "**/*"
description: "禁止代理修改與提示詞無關的內容；不確定時先請求確認。"
---

Agent 變更範圍控管規範（Strict Scope Guard）

目的：確保任何自動或半自動代理（Copilot/AI Agent/Command Runner）只變更「與當前提示詞明確相關」的檔案與程式碼區塊；若範圍或意圖不明，先詢問再動手。

一、硬性規則（Hard Rules） 1. 禁止跨域修改：不得改動與提示詞無關的檔案、函式、類別、設定、測試或文件。 2. 禁止推測性改動：不得以「最佳化」「重構順手」「順便修正」之名做任何未被明確要求的修改。 3. 保持 API 穩定：非明確要求不得更動對外介面、資料結構、資料庫 schema、公開函式簽名與路由。 4. 測試與文件同樣受限：只有在提示詞明確要求或為完成該要求所必須時，才可新增或調整測試與文件。 5. 不確定就停：一旦出現不確定性，不得提交變更，改以「請求確認」流程處理。

二、允許的最小變更（Minimal Allowed Changes）
• 僅限於：提示詞點名之檔案、區塊、函式、常數、樣式或設定。
• 伴隨調整：若為維持編譯通過或單一檔案內部一致性所必須的微小更動，可一併修改，並在提交訊息中註記「必要性」。

三、範圍外問題註記規範（Out-of-Scope Issue Comments）
• 發現問題標記：如果在執行過程中遇到可能是範圍外的程式碼需要修改，以註解形式標記問題。
• 註解格式要求：使用 `FIXME` 或 `TODO` 標註問題與後續行動，並標記註解的時間（年-月-日 時:分）作為判斷依據。
• 依不同程式語言使用對應註解格式： - **JavaScript/TypeScript/C/C++/Java/C#**: `// FIXME 2025-09-28 14:30: 說明問題` 或 `/* TODO 2025-09-28 14:30: 說明問題 */` - **Python**: `# FIXME 2025-09-28 14:30: 說明問題` 或 `# TODO 2025-09-28 14:30: 說明問題` - **HTML/XML**: `<!-- FIXME 2025-09-28 14:30: 說明問題 -->` 或 `<!-- TODO 2025-09-28 14:30: 說明問題 -->` - **CSS/SCSS**: `/* FIXME 2025-09-28 14:30: 說明問題 */` 或 `/* TODO 2025-09-28 14:30: 說明問題 */` - **Bash/Shell**: `# FIXME 2025-09-28 14:30: 說明問題` 或 `# TODO 2025-09-28 14:30: 說明問題` - **SQL**: `-- FIXME 2025-09-28 14:30: 說明問題` 或 `-- TODO 2025-09-28 14:30: 說明問題` - **YAML**: `# FIXME 2025-09-28 14:30: 說明問題` 或 `# TODO 2025-09-28 14:30: 說明問題` - **Markdown**: `<!-- FIXME 2025-09-28 14:30: 說明問題 -->` 或在適當位置加入 > 引用塊
• 標記範例： - `// FIXME 2025-09-28 14:30: 此函式可能需要型別檢查，但超出當前需求範圍` - `# TODO 2025-09-28 14:30: 建議重構此區塊以提升效能，待確認範圍後處理` - `<!-- FIXME 2025-09-28 14:30: 此組件需要無障礙屬性，但非當前焦點 -->`
• 處理原則：標記問題但不修改，保持程式碼功能完整性。

四、明確禁止（Explicitly Forbidden）
• 未被要求的重構、最佳化、格式調整、命名調整。
• 更動 linter/formatter/CI 設定或專案組態。
• 擴增額外相依套件、升降版依賴。
• 新增非必要檔案或刪除既有檔案。
• 任意改寫測試以讓測試通過。

五、提交前檢核清單（Pre-Commit Checklist）

在提交前逐條自問，任一答案為「否」則不得提交：
• 這些變更全部直接對應提示詞的要求嗎？
• 是否完全未改動未被點名的檔案或模組？
• 是否無推測性或順手改動？
• 若有伴隨變更，是否屬「為完成要求不可或缺」？
• 提交訊息是否清楚標示需求、影響範圍與必要性？

六、請求確認流程（Request-for-Clarification）

遇到以下情況時，停下並詢問：
• 需求描述含糊或多解。
• 牽涉跨檔案/跨模組依賴。
• 需要更動公共 API、資料結構、設定或相依。
• 需求與現有程式設計規約衝突。

詢問模板：

需要確認以下事項後再繼續：

1. 目標：{用一句話重述需求}
2. 建議變更檔案/區塊：{列出精確路徑與符號}
3. 潛在外溢影響：{API/Schema/設定/相依}
4. 是否允許：僅 A/B/C 檔？是否可修改測試？
   請確認或提供具體範圍。

六、差異（Diff）約束
• Diff 應聚焦單一目的。避免混合不相關修改。
• 對每個檔案列出「為何必須改動」的一行註記於提交訊息。
• 若工具自動格式化造成大面積變更，撤銷；僅允許對焦於被要求的區塊。

七、提交訊息規範（Commit Message）

feat/fix/docs(chore): <一句話對應提示詞>

- Scope: <精確檔案或符號>
- Necessity: <為完成需求所必須的理由>
- Out-of-scope avoided: <說明如何避免牽連其他部分>

八、違規處理
• 發現非必要或越權變更：全部回滾，重新依規範提交。
• 重複違規的自動代理指令與工作流程需被停用並審核。

九、範例

✅ 合規

提示詞：更新 utils/date.ts 的 formatYMD() 支援自訂分隔符。

    •	只修改 utils/date.ts 的 formatYMD() 與其同檔必要型別。
    •	不更動其他日期工具、locale、CI 或文件。

❌ 違規
• 同時重構 utils/ 全夾。
• 改動 ESLint/Prettier 設定。
• 「順手」把 formatDate() 命名統一為 format()。

⸻

執行準則：若變更與提示詞無直接對應，或存在不確定性，代理必須先啟動「請求確認流程」，在得到明確同意前不得提交任何修改。
