---
applyTo: "**/*.{php,js,ts,jsx,tsx,vue,py,go,html,css,scss,sass,less,json,yaml,yml,xml,sql,env,sh,bat,cmd,conf,toml,ini,properties,lock,mod,sum}, **/Dockerfile*, **/docker-compose*, **/Makefile, **/Jenkinsfile, **/Gemfile*, **/.gitignore, **/.gitattributes, **/.gitmodules, **/.dockerignore, **/.editorconfig, **/.prettierrc*, **/.eslintrc*, **/.env*, **/nginx.conf, **/apache*.conf"
description: "專案變更日誌文件生成規範 - 監控程式碼、配置檔案與系統工程檔案變更"
---

# 變更日誌文件自動生成指令

供 AI 代理在完成專案變更任務後自動產生變更日誌文件的規範與格式。

---

## 觸發條件

**AI 代理在每次指令執行完成後自動建立變更日誌，除非符合排除條件。**

**排除條件（不需要建立變更日誌）：**

1. **僅編輯 Markdown 文件** - 變更僅涉及 `.md` 檔案
2. **僅編輯文件註解** - 變更僅涉及註解或說明文字，未修改程式邏輯
3. **單純查詢操作** - 僅執行讀取、搜尋、分析等操作，未修改任何檔案

**觸發條件（符合任一即建立變更日誌）：**

修改任何 `applyTo` 規則定義的檔案類型，包括：
- 程式碼檔案（PHP、JavaScript、TypeScript、Python、Go 等）
- 配置檔案（JSON、YAML、XML、ENV 等）
- 資料庫檔案（Migration、Schema 等）
- 測試檔案
- 系統工程檔案（Dockerfile、Makefile、CI/CD 配置等）
- 同時修改程式碼和文件的混合變更

**執行時機：** AI 指令執行的最後步驟，在向用戶報告完成之前。

---

## 目標

- 記錄所有專案變更邏輯、變更的檔案目錄名稱
- 提供清晰的變更說明和技術細節
- 便於團隊成員理解變更內容和影響
- 建立可追蹤的變更歷史

---

## 檔案位置與命名規範

### 目錄結構（按時間分層）

**組織原則**：

1. **第一層**：`docs/changes/` - 所有變更日誌統一位置
2. **第二層**：`{年}/` - 四位數年份（如 `2025/`）
3. **第三層**：`{月}/` - 兩位數月份（如 `12/`）
4. **檔案名稱**：`{變更類型}-{描述}.md` 或 `{變更類型}-{編號}-{描述}.md`

```
docs/changes/
├── 2025/
│   ├── 11/
│   │   ├── feat-新增功能A.md
│   │   ├── fix-T019-修復問題B.md
│   │   └── refactor-模組重構.md
│   └── 12/
│       ├── update-快速功能調整.md
│       ├── fix-TK-1558-修復問題C.md
│       └── integrate-階段1-3整合.md
└── 2024/
    └── 12/
        └── feat-新增功能D.md
```

### 檔案命名邏輯

**步驟 1：確定變更類型前綴**

選擇對應的變更類型：`feat`、`refactor`、`fix`、`update`、`integrate`、`report`、`docs`

**步驟 2：添加編號（可選）**

- 有 Ticket 編號：使用 `T019`、`TK-1558` 等格式
- 有階段編號：使用 `階段1`、`階段1-3` 等格式
- 無編號：直接跳到步驟 3

**步驟 3：撰寫中文描述**

使用繁體中文，簡潔明確描述變更內容

### 實際範例

**範例 1：有 Ticket 編號的修復**
```
docs/changes/2025/12/fix-T019-修復問題A.md
```

**範例 2：快速功能調整**
```
docs/changes/2025/12/update-快速功能調整.md
```

**範例 3：有專案編號的問題修復**
```
docs/changes/2025/12/fix-TK-1558-修復問題B.md
```

**範例 4：階段性整合**
```
docs/changes/2025/11/integrate-階段1-3整合.md
```

**範例 5：新功能開發**
```
docs/changes/2025/11/feat-新增功能A.md
```

### 檔案命名格式

**標準格式：**

```
docs/changes/{年}/{月}/{變更類型}-{中文描述}.md
docs/changes/{年}/{月}/{變更類型}-{編號}-{中文描述}.md
```

**命名規則**：

- **必須包含**：變更類型前綴（feat/refactor/fix/update/integrate/report/docs）
- **可選包含**：編號前綴（Ticket 編號如 `T019`、`TK-1558`，或階段編號如 `階段1-3`）
- **中文描述**：使用繁體中文，簡潔明確，3-8 個字為佳
- **分隔符號**：使用半形減號 `-` 連接各部分

### 變更類型

- `feat` - 新功能實作（新增使用者可見的功能）
- `refactor` - 程式碼重構（不改變功能的內部結構調整）
- `fix` - 問題修復（修正錯誤或異常行為）
- `update` - 功能更新（對現有功能的小幅調整）
- `integrate` - 系統整合（多個模組或系統的整合工作）
- `report` - 完成報告（階段性工作成果報告，如測試結果、審查結果）
- `docs` - 文件更新（僅文件內容變更，無程式碼變化）

### 完整命名範例

**基於時間和變更類型的文件路徑：**

| 變更類型 | 編號 | 描述 | 文件路徑 |
| -------- | ---- | ---- | -------- |
| `feat` | - | 新增功能A | `docs/changes/2025/11/feat-新增功能A.md` |
| `fix` | T019 | 修復問題B | `docs/changes/2025/12/fix-T019-修復問題B.md` |
| `fix` | TK-1558 | 修復問題C | `docs/changes/2025/12/fix-TK-1558-修復問題C.md` |
| `refactor` | - | 模組重構 | `docs/changes/2025/11/refactor-模組重構.md` |
| `update` | - | 快速調整 | `docs/changes/2025/12/update-快速功能調整.md` |
| `integrate` | 階段1-3 | 整合修復 | `docs/changes/2025/11/integrate-階段1-3整合.md` |
| `docs` | - | 更新指南 | `docs/changes/2025/12/docs-開發指南更新.md` |

---

## 文件結構規範

**必要章節**（按順序）：

1. **結論** - 此次變更的核心結論與達成目標
2. **問題分析** - 變更前遇到的問題或需要改進的地方
3. **解決方案** - 採用的解決方案和實作方法
4. **變更內容** - 具體變更的檔案和程式碼
5. **注意事項** - 向下相容性、潛在錯誤、體驗影響等需要注意的事項

**文件模板**：

```markdown
# {變更標題}

## 結論
{此次變更的核心結論與達成目標}

## 問題分析
{變更前遇到的問題}

## 解決方案
{採用的解決方案和實作方法}

## 變更內容
{具體變更的檔案和程式碼}

## 注意事項
**向下相容性：**
- {列出對舊版本的影響}
- {是否需要資料遷移或版本升級}

**潛在錯誤：**
- {可能出現的錯誤情況}
- {錯誤的觸發條件與解決方法}

**使用體驗影響：**
- {對使用者操作流程的影響}
- {效能影響或載入時間變化}
- {需要注意的使用限制}
```

---

## 內容格式規範

### 1. 標題規範

- 使用繁體中文
- 層級清晰，最多使用到 H4 (####)
- 具體明確，避免模糊表達
- 禁止使用誇大或主觀形容詞

### 2. 程式碼與路徑格式

**程式碼區塊**：使用對應語言的程式碼標記（如 \`\`\`php、\`\`\`javascript、\`\`\`bash、\`\`\`json 等），確保語法正確
**檔案路徑**：使用相對路徑（從專案根目錄開始），以反引號標記，例如：`src/services/ExampleService.ts`
**目錄結構**：使用樹狀圖展示，清楚標示層級關係

### 3. 狀態標記

使用 emoji 標記重要狀態：

- ✅ **完成** - 已完成的項目
- ⚠️ **注意** - 需要注意的事項
- 🔧 **修復** - 問題修復
- 🆕 **新增** - 新功能
- 🔄 **變更** - 功能變更
- 📋 **測試** - 測試相關
- 🎯 **重要** - 重要資訊

### 4. 統計資料格式

```markdown
**測試統計:**
- **總測試數**: 19 個測試，66 個斷言
- **通過率**: 100% ✅
- **測試分類**:
  - 單元測試: 8 個
  - 整合測試: 6 個
  - 功能測試: 5 個
````

---

## 品質要求

### 1. 內容品質

- **準確性**: 所有技術細節必須準確
- **完整性**: 包含所有必要的資訊
- **清晰性**: 表達清楚，易於理解
- **可操作性**: 提供具體的操作步驟

### 2. 語言規範

- 使用台灣繁體中文
- 避免簡體中文或中國用語
- 技術術語保持一致性
- 語句通順，邏輯清晰

**禁止使用主觀形容詞與誇大修飾：**

以下詞彙**嚴禁使用**，因其會引導使用者期待或產生誤導：

❌ **禁用詞彙**：

- 「專業的」、「企業級」、「強大的」、「優秀的」
- 「完善的」、「高效的」、「先進的」、「卓越的」
- 「最佳的」、「一流的」、「頂級的」、「極致的」
- 「完美的」、「絕佳的」、「傑出的」、「領先的」

✅ **正確表達方式**：

- 陳述客觀事實：「支援 XXX 功能」而非「強大的 XXX 功能」
- 描述具體數據：「回應時間 < 100ms」而非「高效的回應速度」
- 說明實際效果：「減少程式碼重複 30%」而非「優秀的程式碼品質」

**範例對比**：

| ❌ 錯誤表達                | ✅ 正確表達                           |
| -------------------------- | ------------------------------------- |
| 「這是一個專業的解決方案」 | 「這個解決方案實作了 A、B、C 功能」   |
| 「採用了先進的架構設計」   | 「採用模組化架構，包含 6 個獨立模組」 |
| 「提供完善的錯誤處理機制」 | 「捕捉並記錄 5 種類型的錯誤」         |
| 「高效的效能最佳化」       | 「載入時間從 2s 降至 0.8s」           |

### 3. 程式碼品質

- 所有程式碼範例必須可執行
- 提供完整的上下文
- 包含必要的 import 和 namespace
- 遵循專案的程式碼風格

---

## AI 執行檢核清單

**階段一：建立前檢查**

- ✅ **觸發條件** - 已確認符合變更日誌建立條件（程式碼/配置/資料庫/測試/架構變更）
- ✅ **目標位置** - 確認目錄 `docs/changes/{年}/{月}/` 存在或建立
- ✅ **變更類型** - 確定變更類型前綴（feat/refactor/fix/update/integrate/report/docs）
- ✅ **編號確認** - 檢查是否有 Ticket 編號或階段編號
- ✅ **檔案命名** - 使用格式 `{變更類型}-{編號}-{中文描述}.md`，中文簡潔明確

**階段二：內容品質檢查**

- ✅ **章節完整** - 包含 5 個必要章節（結論、問題分析、解決方案、變更內容、注意事項）
- ✅ **注意事項細節** - 已填寫向下相容性、潛在錯誤、使用體驗影響 3 個子項目
- ✅ **程式碼品質** - 所有程式碼範例可執行、語法正確、包含必要的上下文
- ✅ **語言規範** - 使用台灣繁體中文，無主觀形容詞，技術術語一致
- ✅ **禁用詞彙** - 檢查並移除所有禁用詞彙（專業的、強大的、完善的等）

**階段三：完成後驗證**

- ✅ **目錄結構** - 確認目錄存在且與實際檔案位置對應正確
- ✅ **路徑有效性** - 驗證所有檔案路徑和連結有效
- ✅ **內容準確性** - 確認技術細節準確、變更說明完整
- ✅ **影響評估** - 提供完整的變更影響分析（相容性、錯誤、體驗）
- ✅ **可操作性** - 包含具體可操作的步驟或使用指南

**階段四：AI 執行規範**

**✅ AI 應該執行：**
- 建立新的變更日誌文件
- 填寫完整的文件內容
- 建立必要的目錄結構
- 向用戶展示建立的文件路徑
- 說明文件的主要內容

**❌ AI 不應執行：**
- 自動提交檔案到 Git 版本控制
- 自動推送變更到遠端儲存庫
- 自動刪除或移動現有文件（除非用戶明確要求）
- 自動修改 `.gitignore` 或其他配置檔案

**用戶確認流程：**
1. AI 建立文件並展示路徑
2. AI 說明文件的主要內容
3. 等待用戶確認或要求修改
4. 由用戶決定是否提交到版本控制

---

**最後更新**：2025-12-23

這些規範確保 AI 代理建立高品質、結構清晰的變更日誌，同時保持適當的自動化界限，讓用戶保有最終控制權。
