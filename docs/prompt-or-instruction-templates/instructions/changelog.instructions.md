---
applyTo: "docs/changes/**/*.md"
description: "專案變更日誌文件生成規範"
---

# 變更日誌文件自動生成指令

供 AI 代理在完成專案變更任務後自動產生變更日誌文件的規範與格式。

---

## 觸發條件

**AI 代理必須在以下情況完成後自動建立變更日誌：**

1. **任務執行完成** - 當 AI 完成用戶指派的開發任務後
2. **重大變更** - 進行重構、新增功能或重大修改後
3. **多檔案變更** - 變更超過 5 個檔案或 100 行程式碼後
4. **架構調整** - 涉及系統架構或配置的重要變更後

**執行時機：** AI 任務執行的最後步驟，在提交程式碼變更之前。

---

## 目標

- 記錄所有專案變更邏輯、變更的檔案目錄名稱
- 提供清晰的變更說明和技術細節
- 便於團隊成員理解變更內容和影響
- 建立可追蹤的變更歷史

---

## 檔案位置與命名規範

### 目錄結構（按日期分類）

```
docs/changes/
├── 2025/
│   ├── 09/
│   │   ├── feature-user-auth.md
│   │   ├── refactor-api-layer.md
│   │   └── fix-database-connection.md
│   └── 10/
│       └── update-testing-framework.md
└── 2024/
    └── 12/
        └── initial-project-setup.md
```

### 檔案命名格式

```
docs/changes/{YYYY}/{MM}/{變更類型}-{簡短描述}.md
```

### 變更類型（簡化）

- `feature` - 新功能
- `refactor` - 重構
- `fix` - 修復
- `update` - 更新
- `config` - 配置
- `docs` - 文件

### 命名範例

- `docs/changes/2025/09/feature-user-auth.md`
- `docs/changes/2025/09/refactor-api-layer.md`
- `docs/changes/2025/09/fix-database-connection.md`
- `docs/changes/2025/10/update-testing-framework.md`

---

## 文件結構規範

### 必要章節

```markdown
# {變更標題}

## 變更概要

簡要說明此次變更的目的和範圍

## 問題分析

描述變更前遇到的問題或需要改進的地方

## 解決方案

詳細說明採用的解決方案和實作方法

## 變更內容

列出具體的變更項目和檔案

## 測試結果

說明測試覆蓋率和測試結果

## 影響評估

分析變更對現有功能的影響

## 使用指南

提供新功能或變更後功能的使用方法

## 未來改進

列出可能的進一步改進方向
```

### 可選章節

- `技術細節` - 深入的技術實作說明
- `相關連結` - 相關文件或資源連結
- `注意事項` - 使用或維護時需要注意的事項
- `相容性說明` - 向下相容性或破壞性變更說明

---

## 內容格式規範

### 1. 標題規範

- 使用繁體中文
- 層級清晰，最多使用到 H4 (####)
- 具體明確，避免模糊表達

### 2. 程式碼區塊

````markdown
# PHP 程式碼

```php
class ExampleService
{
    public function example(): array
    {
        return ['status' => 'success'];
    }
}
```
````

# Bash 指令

```bash
./vendor/bin/sail test tests/Feature/ExampleTest.php
```

# 設定檔案

```env
APP_ENV=production
FEATURE_ENABLED=true
```

```

### 3. 檔案路徑格式

- 使用相對路徑，從專案根目錄開始
- 使用反引號標記：`app/Services/ExampleService.php`
- 目錄結構使用樹狀圖：

```

app/
├── Http/Controllers/
│ ├── API/V1/
│ └── Web/
├── Services/
└── Models/

````

### 4. 狀態標記

使用 emoji 標記重要狀態：

- ✅ **完成** - 已完成的項目
- ⚠️ **注意** - 需要注意的事項
- 🔧 **修復** - 問題修復
- 🆕 **新增** - 新功能
- 🔄 **變更** - 功能變更
- 📋 **測試** - 測試相關
- 🎯 **重要** - 重要資訊

### 5. 統計資料格式

```markdown
**測試統計:**
- **總測試數**: 19 個測試，66 個斷言
- **通過率**: 100% ✅
- **測試分類**:
  - EmailVerificationServiceTest: 8 個測試
  - Web EmailVerificationTest: 6 個測試
  - API EmailVerificationTest: 5 個測試
````

---

## 品質要求

### 1. 內容品質

- **準確性**: 所有技術細節必須準確
- **完整性**: 包含所有必要的資訊
- **清晰性**: 表達清楚，易於理解
- **可操作性**: 提供具體的操作步驟

### 2. 語言規範

- 使用台灣繁體中文
- 避免簡體中文或中國用語
- 技術術語保持一致性
- 語句通順，邏輯清晰

### 3. 程式碼品質

- 所有程式碼範例必須可執行
- 提供完整的上下文
- 包含必要的 import 和 namespace
- 遵循專案的程式碼風格

---

## 自動檔案管理

### 1. 自動目錄建立

**AI 代理自動執行：**

- 檢查並建立 `docs/changes/{YYYY}/{MM}/` 目錄結構
- 自動確定年月日期（使用系統當前時間）
- 避免目錄名稱衝突和重複建立

### 2. 版本控制整合

**自動化流程：**

- AI 完成變更日誌建立後自動提交到 Git
- 提交訊息自動包含變更摘要和檔案路徑
- 保持變更日誌與程式碼變更的同步性

### 3. 檔案關聯與索引

**自動更新：**

- 在主 README.md 中更新變更日誌索引
- 建立月度和年度的變更摘要連結
- 相關功能文件中自動引用對應變更

### 4. 歸檔與整理

**長期維護策略：**

- 按年度自動歸檔舊的變更記錄至 `docs/archive/`
- 保持當年度的變更在 `docs/changes/` 主目錄
- 自動清理和整理過時的技術細節

---

## 範例檔案參考

### 新的目錄結構範例

現有範例檔案（使用新規範後的結構）：

- `docs/changes/2025/09/docs-testing-infrastructure-enhancement.md`
- `docs/changes/2025/09/docs-documentation-project.md`
- `docs/changes/2025/09/feature-project-completion-report.md`

### 舊的檔案（需要移動）

以下檔案將需要移動到新的目錄結構：

- `docs/changes/2025-09-19-testing-infrastructure-enhancement.md`
  → `docs/changes/2025/09/docs-testing-infrastructure-enhancement.md`
- `docs/changes/2025-09-19-documentation-project.md`
  → `docs/changes/2025/09/docs-documentation-project.md`
- `docs/changes/project-completion-report.md`
  → `docs/changes/2025/09/feature-project-completion-report.md`

---

## AI 自動化流程

### 1. 自動檔案建立流程

**AI 代理必須按以下步驟執行：**

1. **分析變更內容** - 檢查修改的檔案和變更範圍
2. **確定變更類型** - 根據變更性質選擇適當類型標籤
3. **建立目錄結構** - 自動建立 `{YYYY}/{MM}/` 目錄（如不存在）
4. **生成檔案名稱** - 使用簡化命名格式
5. **填寫變更內容** - 按照標準模板填寫詳細資訊
6. **提交變更記錄** - 將變更日誌納入版本控制

### 2. 檔案模板

**AI 代理使用的標準模板：**

```markdown
# {變更標題}

## 變更概要

{簡要說明}

## 問題分析

{問題描述}

## 解決方案

{解決方案說明}

## 變更內容

{具體變更}

## 測試結果

{測試統計}

## 影響評估

{影響分析}

## 使用指南

{使用方法}

## 未來改進

{改進方向}
```

### 3. AI 執行檢查清單

**每個變更日誌檔案建立前，AI 必須確認：**

- [ ] 已確認觸發條件（任務完成/重大變更）
- [ ] 目錄結構正確建立（YYYY/MM/）
- [ ] 檔案命名符合簡化規範
- [ ] 包含所有必要章節內容
- [ ] 變更內容描述完整準確
- [ ] 程式碼範例（如有）可執行
- [ ] 已提交到版本控制系統

### 4. 自動化觸發範例

```
用戶請求："請幫我重構 API 層架構"
↓ AI 執行任務
↓ 任務完成後
↓ 自動觸發變更日誌建立
↓ 建立檔案：docs/changes/2025/09/refactor-api-layer.md
↓ 提交變更記錄
```

---

## AI 自動化維護

### 1. AI 自動檢視與維護

**每次任務執行時 AI 應：**

- 檢查目錄結構的完整性和一致性
- 驗證變更日誌內容的準確性和完整性
- 更新相關文件的索引和連結
- 確保檔案命名和內容符合最新規範

### 2. 持續最佳化

**AI 應持續：**

- 根據實際使用經驗最佳化文件結構
- 改進變更描述的清晰度和實用性
- 保持與主專案的技術演進同步

### 3. 品質保證

**每次生成變更日誌時，AI 必須：**

- 確保所有程式碼範例可執行正確
- 驗證所有檔案路徑和連結的有效性
- 使用繁體中文和正確的技術術語
- 提供完整的變更影響分析和使用指南

---

這些規範確保 AI 代理可以在任務完成後自動建立高品質的變更日誌，使專案的變更歷史清晰可追蹤，便於團隊協作和知識傳承。
